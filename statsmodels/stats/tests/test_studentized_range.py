# -*- coding: utf-8 -*-
"""
Created on Wed Sep 15 2021
Author: Eric Farng

Notes
-----
This Python code is compared to results from R and is similar up to around 5 digits, depending on parameters
R code is included.

This Python code is is also compared to results from Pascal and is similar to around 12 digits, depending on parameters
Pascal code is also included.

The original pascal code was created and validated by the authors in this paper
http://jaguar.fcav.unesp.br/RME/fasciculos/v25/v25_n1/A8_Daniel.pdf

"""

import statsmodels.stats.studentized_range as tukey
import statsmodels.stats.libqsturng.qsturng_ as qsturng
from numpy.testing import assert_equal
import numpy as np



def test_prange():
    """ R code to generate target values used in this test.
    for (q in c(1.3, 2.7, 4.7, 10.5, 18.4, 31.1)) {
        for (r in c(2, 3, 4, 5, 8, 13, 23)) {
            for (v in c(3.6, 5.4, 7.9, 13.6, 17.3, 31.6)) {
                print(paste(q, r, v, ptukey(q, r, v)))
            }
        }
    }
    """
    """ Pascal code to generate target values used in this test.
    This depends on the same pascal code in studentized_range.py

    var ifault:LongInt;
    q, v: Real;
    r: Integer;
    q_list: Array[1..6] of Real = (1.3, 2.7, 4.7, 10.5, 18.4, 31.1);
    r_list: Array[1..7] of Integer = (2, 3, 4, 5, 8, 13, 23);
    v_list: Array[1..6] of Real = (3.6, 5.4, 7.9, 13.6, 17.3, 31.6);

    begin
      for q in q_list do
      begin
          for r in r_list do
          begin
              for v in v_list do
              begin
                  writeln(q:4:1,',',r:2,',',v:4:1,':',PRange(q , r,  v, 1, ifault):18:12)
              end;
          end;
      end;
    end.
    """
    target_r = {
        "1.3,2,3.6": 0.58466664119419,
        "1.3,2,5.4": 0.60282604469542,
        "1.3,2,7.9": 0.614821699237477,
        "1.3,2,13.6": 0.626012690435215,
        "1.3,2,17.3": 0.629389401842842,
        "1.3,2,31.6": 0.635065310348764,
        "1.3,3,3.6": 0.338674516502371,
        "1.3,3,5.4": 0.348814863777,
        "1.3,3,7.9": 0.355681838977955,
        "1.3,3,13.6": 0.362233016918739,
        "1.3,3,17.3": 0.364240452248553,
        "1.3,3,31.6": 0.367649609140809,
        "1.3,4,3.6": 0.201804821714354,
        "1.3,4,5.4": 0.203384042690175,
        "1.3,4,7.9": 0.204219569680657,
        "1.3,4,13.6": 0.204837317821486,
        "1.3,4,17.3": 0.204991306031518,
        "1.3,4,31.6": 0.205214792990431,
        "1.3,5,3.6": 0.124288636352505,
        "1.3,5,5.4": 0.120927855902523,
        "1.3,5,7.9": 0.118232711463615,
        "1.3,5,13.6": 0.115324925951593,
        "1.3,5,17.3": 0.114365182450269,
        "1.3,5,31.6": 0.112658783311411,
        "1.3,8,3.6": 0.0346458938664163,
        "1.3,8,5.4": 0.0290361170112601,
        "1.3,8,7.9": 0.0251142948955917,
        "1.3,8,13.6": 0.0213133277188012,
        "1.3,8,17.3": 0.0201423382103481,
        "1.3,8,31.6": 0.0181522689861116,
        "1.3,13,3.6": 0.00633009638602189,
        "1.3,13,5.4": 0.00392989543040534,
        "1.3,13,7.9": 0.00259149090536131,
        "1.3,13,13.6": 0.00156343110767252,
        "1.3,13,17.3": 0.00130034622103117,
        "1.3,13,31.6": 0.000911167624821055,
        "1.3,23,3.6": 0.00053052892344719,
        "1.3,23,5.4": 0.000181578467245044,
        "1.3,23,7.9": 0.0000661661993745349,
        "1.3,23,13.6": 0.000017299535449416,
        "1.3,23,17.3": 0.000010200853545734,
        "1.3,23,31.6": 0.00000341684824324155,
        "2.7,2,3.6": 0.863255277277541,
        "2.7,2,5.4": 0.889787817932006,
        "2.7,2,7.9": 0.906889459462312,
        "2.7,2,13.6": 0.922436256038603,
        "2.7,2,17.3": 0.927033322024794,
        "2.7,2,31.6": 0.934645853307027,
        "2.7,3,3.6": 0.739294863697028,
        "2.7,3,5.4": 0.775854629933479,
        "2.7,3,7.9": 0.801391691837278,
        "2.7,3,13.6": 0.826317752893301,
        "2.7,3,17.3": 0.834058739836904,
        "2.7,3,31.6": 0.847305886753683,
        "2.7,4,3.6": 0.638305803233478,
        "2.7,4,5.4": 0.675407371272622,
        "2.7,4,7.9": 0.702654058500363,
        "2.7,4,13.6": 0.730573617100954,
        "2.7,4,17.3": 0.739556174038206,
        "2.7,4,31.6": 0.755318734078203,
        "2.7,5,3.6": 0.557035415258598,
        "2.7,5,5.4": 0.590318279734459,
        "2.7,5,7.9": 0.615481394164308,
        "2.7,5,13.6": 0.64209507315363,
        "2.7,5,17.3": 0.650871154997858,
        "2.7,5,31.6": 0.666562384292691,
        "2.7,8,3.6": 0.392247802248294,
        "2.7,8,5.4": 0.40849256027931,
        "2.7,8,7.9": 0.420513045229746,
        "2.7,8,13.6": 0.433168907906246,
        "2.7,8,17.3": 0.437370010436707,
        "2.7,8,31.6": 0.444970945295716,
        "2.7,13,3.6": 0.250452765353309,
        "2.7,13,5.4": 0.246438684128468,
        "2.7,13,7.9": 0.24095899703457,
        "2.7,13,13.6": 0.232475888088804,
        "2.7,13,17.3": 0.228980621574148,
        "2.7,13,31.6": 0.221733011412868,
        "2.7,23,3.6": 0.134057823618845,
        "2.7,23,5.4": 0.11640489010023,
        "2.7,23,7.9": 0.100114077900976,
        "2.7,23,13.6": 0.0799557783919358,
        "2.7,23,17.3": 0.07263064446017,
        "2.7,23,31.6": 0.0587039248067928,
        "4.7,2,3.6": 0.965701178651381,
        "4.7,2,5.4": 0.981352509369915,
        "4.7,2,7.9": 0.989324047448078,
        "4.7,2,13.6": 0.9947992297825,
        "4.7,2,17.3": 0.996054378249031,
        "4.7,2,31.6": 0.997742299307999,
        "4.7,3,3.6": 0.929282419147943,
        "4.7,3,5.4": 0.957979394722983,
        "4.7,3,7.9": 0.9742417526507,
        "4.7,3,13.6": 0.986526776264137,
        "4.7,3,17.3": 0.989544651389355,
        "4.7,3,31.6": 0.993783339729999,
        "4.7,4,3.6": 0.895360700723319,
        "4.7,4,5.4": 0.933718060252026,
        "4.7,4,7.9": 0.957206271096568,
        "4.7,4,13.6": 0.976309880082049,
        "4.7,4,17.3": 0.981270115477121,
        "4.7,4,31.6": 0.988496172299614,
        "4.7,5,3.6": 0.864646851644785,
        "4.7,5,5.4": 0.90996251337078,
        "4.7,5,7.9": 0.939410604768391,
        "4.7,5,13.6": 0.964839162972844,
        "4.7,5,17.3": 0.971754029966962,
        "4.7,5,31.6": 0.982153184765828,
        "4.7,8,3.6": 0.789321871358646,
        "4.7,8,5.4": 0.845454202729954,
        "4.7,8,7.9": 0.88647967263856,
        "4.7,8,13.6": 0.926766029566565,
        "4.7,8,17.3": 0.938922097277942,
        "4.7,8,31.6": 0.958663147287837,
        "4.7,13,3.6": 0.701190859300069,
        "4.7,13,5.4": 0.760398372468425,
        "4.7,13,7.9": 0.808278747131596,
        "4.7,13,13.6": 0.861586535023949,
        "4.7,13,17.3": 0.879532555155613,
        "4.7,13,31.6": 0.911446761479236,
        "4.7,23,3.6": 0.593091214732045,
        "4.7,23,5.4": 0.644807358998587,
        "4.7,23,7.9": 0.690063763880326,
        "4.7,23,13.6": 0.746713311475974,
        "4.7,23,17.3": 0.768081131287351,
        "4.7,23,31.6": 0.810517806998851,
        "10.5,2,3.6": 0.997365205839915,
        "10.5,2,5.4": 0.999502721186902,
        "10.5,2,7.9": 0.999920575681256,
        "10.5,2,13.6": 0.999996161918886,
        "10.5,2,17.3": 0.99999910842918,
        "10.5,2,31.6": 0.99999997947406,
        "10.5,3,3.6": 0.994342847090587,
        "10.5,3,5.4": 0.998813416115106,
        "10.5,3,7.9": 0.999794422030666,
        "10.5,3,13.6": 0.999989220301904,
        "10.5,3,17.3": 0.999997437282804,
        "10.5,3,31.6": 0.999999939145081,
        "10.5,4,3.6": 0.991338091093988,
        "10.5,4,5.4": 0.998036428405789,
        "10.5,4,7.9": 0.999637471032902,
        "10.5,4,13.6": 0.999979668724251,
        "10.5,4,17.3": 0.999995069434843,
        "10.5,4,31.6": 0.999999879639983,
        "10.5,5,3.6": 0.988459223651548,
        "10.5,5,5.4": 0.997219637034824,
        "10.5,5,7.9": 0.999459124997922,
        "10.5,5,13.6": 0.999967872337075,
        "10.5,5,17.3": 0.999992070525726,
        "10.5,5,31.6": 0.999999801516345,
        "10.5,8,3.6": 0.980736702840839,
        "10.5,8,5.4": 0.994725999954621,
        "10.5,8,7.9": 0.998847552974836,
        "10.5,8,13.6": 0.999921594596698,
        "10.5,8,17.3": 0.999979787550525,
        "10.5,8,31.6": 0.999999460264084,
        "10.5,13,3.6": 0.970354166841924,
        "10.5,13,5.4": 0.990781039530525,
        "10.5,13,7.9": 0.997718363209151,
        "10.5,13,13.6": 0.999818083397922,
        "10.5,13,17.3": 0.999950474270275,
        "10.5,13,31.6": 0.999998559182894,
        "10.5,23,3.6": 0.955163756760846,
        "10.5,23,5.4": 0.983983753653348,
        "10.5,23,7.9": 0.995413736455173,
        "10.5,23,13.6": 0.999551826011573,
        "10.5,23,17.3": 0.999868343998436,
        "10.5,23,31.6": 0.999995647322333,
        "18.4,2,3.6": 0.999621501433495,
        "18.4,2,5.4": 0.999972374909551,
        "18.4,2,7.9": 0.999998698849414,
        "18.4,2,13.6": 0.999999995359118,
        "18.4,2,17.3": 0.999999999768984,
        "18.4,2,31.6": 0.999999999999866,
        "18.4,3,3.6": 0.999188923763859,
        "18.4,3,5.4": 0.999933523207897,
        "18.4,3,7.9": 0.999996578560463,
        "18.4,3,13.6": 0.999999986768273,
        "18.4,3,17.3": 0.999999999327382,
        "18.4,3,31.6": 0.999999999999803,
        "18.4,4,3.6": 0.998762627852459,
        "18.4,4,5.4": 0.999888563209893,
        "18.4,4,7.9": 0.99999389485085,
        "18.4,4,13.6": 0.999999974704892,
        "18.4,4,17.3": 0.999999998690844,
        "18.4,4,31.6": 0.99999999999971,
        "18.4,5,3.6": 0.998350184925806,
        "18.4,5,5.4": 0.999840108503624,
        "18.4,5,7.9": 0.999990808043297,
        "18.4,5,13.6": 0.999999959533708,
        "18.4,5,17.3": 0.999999997872391,
        "18.4,5,31.6": 0.999999999999587,
        "18.4,8,3.6": 0.997191719242235,
        "18.4,8,5.4": 0.999687111906919,
        "18.4,8,7.9": 0.999980061567203,
        "18.4,8,13.6": 0.999999898048726,
        "18.4,8,17.3": 0.999999994429539,
        "18.4,8,31.6": 0.999999999999041,
        "18.4,13,3.6": 0.995539273243489,
        "18.4,13,5.4": 0.999440996468962,
        "18.4,13,7.9": 0.999959838384821,
        "18.4,13,13.6": 0.999999753217561,
        "18.4,13,17.3": 0.999999985866557,
        "18.4,13,31.6": 0.999999999997562,
        "18.4,23,3.6": 0.993198280920168,
        "18.4,23,5.4": 0.999024492623395,
        "18.4,23,7.9": 0.999916533715689,
        "18.4,23,13.6": 0.999999353274044,
        "18.4,23,17.3": 0.999999960477883,
        "18.4,23,31.6": 0.999999999992572,
        "31.1,2,3.6": 0.999936392766846,
        "31.1,2,5.4": 0.999997785016059,
        "31.1,2,7.9": 0.999999981897526,
        "31.1,2,13.6": 0.99999999999296,
        "31.1,2,17.3": 0.999999999999822,
        "31.1,2,31.6": 0.9999999999999,
        "31.1,3,3.6": 0.999848495624002,
        "31.1,3,5.4": 0.99999516149324,
        "31.1,3,7.9": 0.999999953949567,
        "31.1,3,13.6": 0.999999999982076,
        "31.1,3,17.3": 0.999999999999721,
        "31.1,3,31.6": 0.9999999999999,
        "31.1,4,3.6": 0.999761355126997,
        "31.1,4,5.4": 0.999992456202357,
        "31.1,4,7.9": 0.999999920115985,
        "31.1,4,13.6": 0.999999999966372,
        "31.1,4,17.3": 0.999999999999576,
        "31.1,4,31.6": 0.9999999999999,
        "31.1,5,3.6": 0.999682056205725,
        "31.1,5,5.4": 0.999989868796949,
        "31.1,5,7.9": 0.999999881955735,
        "31.1,5,13.6": 0.999999999946167,
        "31.1,5,17.3": 0.999999999999388,
        "31.1,5,31.6": 0.9999999999999,
        "31.1,8,3.6": 0.999503088951052,
        "31.1,8,5.4": 0.999983193438092,
        "31.1,8,7.9": 0.999999746755469,
        "31.1,8,13.6": 0.999999999861165,
        "31.1,8,17.3": 0.999999999998594,
        "31.1,8,31.6": 0.9999999999999,
        "31.1,13,3.6": 0.999340861909251,
        "31.1,13,5.4": 0.999974311520405,
        "31.1,13,7.9": 0.999999457982855,
        "31.1,13,13.6": 0.999999999650516,
        "31.1,13,17.3": 0.999999999996614,
        "31.1,13,31.6": 0.9999999999999,
        "31.1,23,3.6": 0.999157253748134,
        "31.1,23,5.4": 0.9999563170687,
        "31.1,23,7.9": 0.999998664760184,
        "31.1,23,13.6": 0.99999999903617,
        "31.1,23,17.3": 0.999999999990787,
        "31.1,23,31.6": 0.9999999999999
    }
    target_pascal = {
        "1.3,2,3.6": 0.584666876291,
        "1.3,2,5.4": 0.602826038316,
        "1.3,2,7.9": 0.614821699460,
        "1.3,2,13.6": 0.626012690435,
        "1.3,2,17.3": 0.629389401843,
        "1.3,2,31.6": 0.635065310349,
        "1.3,3,3.6": 0.338674525233,
        "1.3,3,5.4": 0.348814863179,
        "1.3,3,7.9": 0.355681838981,
        "1.3,3,13.6": 0.362233016919,
        "1.3,3,17.3": 0.364240452249,
        "1.3,3,31.6": 0.367649609141,
        "1.3,4,3.6": 0.201804821031,
        "1.3,4,5.4": 0.203384042723,
        "1.3,4,7.9": 0.204219569680,
        "1.3,4,13.6": 0.204837317823,
        "1.3,4,17.3": 0.204991306033,
        "1.3,4,31.6": 0.205214792992,
        "1.3,5,3.6": 0.124288636323,
        "1.3,5,5.4": 0.120927855909,
        "1.3,5,7.9": 0.118232711467,
        "1.3,5,13.6": 0.115324925956,
        "1.3,5,17.3": 0.114365182454,
        "1.3,5,31.6": 0.112658783316,
        "1.3,8,3.6": 0.034645893834,
        "1.3,8,5.4": 0.029036116975,
        "1.3,8,7.9": 0.025114294855,
        "1.3,8,13.6": 0.021313327673,
        "1.3,8,17.3": 0.020142338163,
        "1.3,8,31.6": 0.018152268935,
        "1.3,13,3.6": 0.006330096389,
        "1.3,13,5.4": 0.003929895439,
        "1.3,13,7.9": 0.002591490925,
        "1.3,13,13.6": 0.001563431141,
        "1.3,13,17.3": 0.001300346259,
        "1.3,13,31.6": 0.000911167670,
        "1.3,23,3.6": 0.000530528951,
        "1.3,23,5.4": 0.000181578516,
        "1.3,23,7.9": 0.000066166227,
        "1.3,23,13.6": 0.000017299542,
        "1.3,23,17.3": 0.000010200856,
        "1.3,23,31.6": 0.000003416847,
        "2.7,2,3.6": 0.863255767312,
        "2.7,2,5.4": 0.889787804603,
        "2.7,2,7.9": 0.906889459929,
        "2.7,2,13.6": 0.922436256038,
        "2.7,2,17.3": 0.927033322025,
        "2.7,2,31.6": 0.934645853307,
        "2.7,3,3.6": 0.739294901680,
        "2.7,3,5.4": 0.775854627327,
        "2.7,3,7.9": 0.801391691852,
        "2.7,3,13.6": 0.826317752893,
        "2.7,3,17.3": 0.834058739837,
        "2.7,3,31.6": 0.847305886754,
        "2.7,4,3.6": 0.638305797019,
        "2.7,4,5.4": 0.675407371561,
        "2.7,4,7.9": 0.702654058484,
        "2.7,4,13.6": 0.730573617103,
        "2.7,4,17.3": 0.739556174040,
        "2.7,4,31.6": 0.755318734080,
        "2.7,5,3.6": 0.557035414659,
        "2.7,5,5.4": 0.590318279805,
        "2.7,5,7.9": 0.615481394170,
        "2.7,5,13.6": 0.642095073161,
        "2.7,5,17.3": 0.650871155005,
        "2.7,5,31.6": 0.666562384299,
        "2.7,8,3.6": 0.392247802150,
        "2.7,8,5.4": 0.408492560173,
        "2.7,8,7.9": 0.420513045110,
        "2.7,8,13.6": 0.433168907766,
        "2.7,8,17.3": 0.437370010290,
        "2.7,8,31.6": 0.444970945146,
        "2.7,13,3.6": 0.250452765807,
        "2.7,13,5.4": 0.246438684731,
        "2.7,13,7.9": 0.240958997813,
        "2.7,13,13.6": 0.232475889186,
        "2.7,13,17.3": 0.228980622824,
        "2.7,13,31.6": 0.221733012944,
        "2.7,23,3.6": 0.134057820007,
        "2.7,23,5.4": 0.116404884968,
        "2.7,23,7.9": 0.100114070751,
        "2.7,23,13.6": 0.079955767300,
        "2.7,23,17.3": 0.072630631396,
        "2.7,23,31.6": 0.058703907908,
        "4.7,2,3.6": 0.965702039900,
        "4.7,2,5.4": 0.981352485783,
        "4.7,2,7.9": 0.989324048283,
        "4.7,2,13.6": 0.994799229781,
        "4.7,2,17.3": 0.996054378249,
        "4.7,2,31.6": 0.997742299308,
        "4.7,3,3.6": 0.929282536796,
        "4.7,3,5.4": 0.957979386545,
        "4.7,3,7.9": 0.974241752694,
        "4.7,3,13.6": 0.986526776264,
        "4.7,3,17.3": 0.989544651389,
        "4.7,3,31.6": 0.993783339730,
        "4.7,4,3.6": 0.895360666655,
        "4.7,4,5.4": 0.933718061871,
        "4.7,4,7.9": 0.957206270987,
        "4.7,4,13.6": 0.976309880083,
        "4.7,4,17.3": 0.981270115478,
        "4.7,4,31.6": 0.988496172300,
        "4.7,5,3.6": 0.864646845779,
        "4.7,5,5.4": 0.909962514042,
        "4.7,5,7.9": 0.939410604765,
        "4.7,5,13.6": 0.964839162976,
        "4.7,5,17.3": 0.971754029969,
        "4.7,5,31.6": 0.982153184767,
        "4.7,8,3.6": 0.789321871096,
        "4.7,8,5.4": 0.845454202712,
        "4.7,8,7.9": 0.886479672602,
        "4.7,8,13.6": 0.926766029552,
        "4.7,8,17.3": 0.938922097271,
        "4.7,8,31.6": 0.958663147293,
        "4.7,13,3.6": 0.701190859336,
        "4.7,13,5.4": 0.760398372482,
        "4.7,13,7.9": 0.808278747098,
        "4.7,13,13.6": 0.861586534917,
        "4.7,13,17.3": 0.879532555032,
        "4.7,13,31.6": 0.911446761402,
        "4.7,23,3.6": 0.593091215343,
        "4.7,23,5.4": 0.644807360174,
        "4.7,23,7.9": 0.690063765725,
        "4.7,23,13.6": 0.746713314064,
        "4.7,23,17.3": 0.768081133888,
        "4.7,23,31.6": 0.810517808263,
        "10.5,2,3.6": 0.997367252845,
        "10.5,2,5.4": 0.999502662321,
        "10.5,2,7.9": 0.999920578011,
        "10.5,2,13.6": 0.999996161913,
        "10.5,2,17.3": 0.999999108430,
        "10.5,2,31.6": 0.999999979474,
        "10.5,3,3.6": 0.994343525928,
        "10.5,3,5.4": 0.998813363884,
        "10.5,3,7.9": 0.999794422413,
        "10.5,3,13.6": 0.999989220276,
        "10.5,3,17.3": 0.999997437285,
        "10.5,3,31.6": 0.999999939145,
        "10.5,4,3.6": 0.991337592908,
        "10.5,4,5.4": 0.998036456678,
        "10.5,4,7.9": 0.999637468155,
        "10.5,4,13.6": 0.999979668684,
        "10.5,4,17.3": 0.999995069436,
        "10.5,4,31.6": 0.999999879640,
        "10.5,5,3.6": 0.988458987600,
        "10.5,5,5.4": 0.997219675036,
        "10.5,5,7.9": 0.999459122742,
        "10.5,5,13.6": 0.999967872318,
        "10.5,5,17.3": 0.999992070521,
        "10.5,5,31.6": 0.999999801517,
        "10.5,8,3.6": 0.980736583565,
        "10.5,8,5.4": 0.994725937180,
        "10.5,8,7.9": 0.998847568769,
        "10.5,8,13.6": 0.999921595131,
        "10.5,8,17.3": 0.999979787465,
        "10.5,8,31.6": 0.999999460265,
        "10.5,13,3.6": 0.970355092540,
        "10.5,13,5.4": 0.990781296277,
        "10.5,13,7.9": 0.997718288802,
        "10.5,13,13.6": 0.999818085767,
        "10.5,13,17.3": 0.999950473736,
        "10.5,13,31.6": 0.999998559187,
        "10.5,23,3.6": 0.955159592031,
        "10.5,23,5.4": 0.983982822686,
        "10.5,23,7.9": 0.995414019789,
        "10.5,23,13.6": 0.999551810381,
        "10.5,23,17.3": 0.999868343334,
        "10.5,23,31.6": 0.999995647344,
        "18.4,2,3.6": 0.999625987587,
        "18.4,2,5.4": 0.999972234091,
        "18.4,2,7.9": 0.999998705767,
        "18.4,2,13.6": 0.999999995353,
        "18.4,2,17.3": 0.999999999770,
        "18.4,2,31.6": 1.000000000000,
        "18.4,3,3.6": 0.999193486465,
        "18.4,3,5.4": 0.999932983205,
        "18.4,3,7.9": 0.999996605591,
        "18.4,3,13.6": 0.999999986760,
        "18.4,3,17.3": 0.999999999330,
        "18.4,3,31.6": 1.000000000000,
        "18.4,4,3.6": 0.998759503110,
        "18.4,4,5.4": 0.999887947490,
        "18.4,4,7.9": 0.999993947923,
        "18.4,4,13.6": 0.999999974716,
        "18.4,4,17.3": 0.999999998697,
        "18.4,4,31.6": 1.000000000000,
        "18.4,5,3.6": 0.998337908479,
        "18.4,5,5.4": 0.999839951739,
        "18.4,5,7.9": 0.999990883248,
        "18.4,5,13.6": 0.999999959598,
        "18.4,5,17.3": 0.999999997882,
        "18.4,5,31.6": 1.000000000000,
        "18.4,8,3.6": 0.997182029046,
        "18.4,8,5.4": 0.999690752127,
        "18.4,8,7.9": 0.999980096302,
        "18.4,8,13.6": 0.999999898593,
        "18.4,8,17.3": 0.999999994451,
        "18.4,8,31.6": 0.999999999999,
        "18.4,13,3.6": 0.995605161963,
        "18.4,13,5.4": 0.999448036737,
        "18.4,13,7.9": 0.999959285839,
        "18.4,13,13.6": 0.999999756006,
        "18.4,13,17.3": 0.999999985896,
        "18.4,13,31.6": 0.999999999998,
        "18.4,23,3.6": 0.993218283596,
        "18.4,23,5.4": 0.999005797914,
        "18.4,23,7.9": 0.999914321363,
        "18.4,23,13.6": 0.999999365889,
        "18.4,23,17.3": 0.999999960355,
        "18.4,23,31.6": 0.999999999993,
        "31.1,2,3.6": 0.999938087152,
        "31.1,2,5.4": 0.999998256387,
        "31.1,2,7.9": 0.999999978698,
        "31.1,2,13.6": 0.999999999995,
        "31.1,2,17.3": 1.000000000000,
        "31.1,2,31.6": 1.000000000000,
        "31.1,3,3.6": 0.999865056709,
        "31.1,3,5.4": 0.999996024411,
        "31.1,3,7.9": 0.999999942875,
        "31.1,3,13.6": 0.999999999985,
        "31.1,3,17.3": 1.000000000000,
        "31.1,3,31.6": 1.000000000000,
        "31.1,4,3.6": 0.999797095791,
        "31.1,4,5.4": 0.999993560293,
        "31.1,4,7.9": 0.999999895859,
        "31.1,4,13.6": 0.999999999972,
        "31.1,4,17.3": 1.000000000000,
        "31.1,4,31.6": 1.000000000000,
        "31.1,5,3.6": 0.999736537501,
        "31.1,5,5.4": 0.999990961024,
        "31.1,5,7.9": 0.999999839671,
        "31.1,5,13.6": 0.999999999955,
        "31.1,5,17.3": 1.000000000000,
        "31.1,5,31.6": 1.000000000000,
        "31.1,8,3.6": 0.999587245156,
        "31.1,8,5.4": 0.999982530413,
        "31.1,8,7.9": 0.999999629169,
        "31.1,8,13.6": 0.999999999889,
        "31.1,8,17.3": 0.999999999999,
        "31.1,8,31.6": 1.000000000000,
        "31.1,13,3.6": 0.999374017523,
        "31.1,13,5.4": 0.999966643370,
        "31.1,13,7.9": 0.999999189707,
        "31.1,13,13.6": 0.999999999737,
        "31.1,13,17.3": 0.999999999997,
        "31.1,13,31.6": 1.000000000000,
        "31.1,23,3.6": 0.998950548436,
        "31.1,23,5.4": 0.999932125189,
        "31.1,23,7.9": 0.999998197764,
        "31.1,23,13.6": 0.999999999339,
        "31.1,23,17.3": 0.999999999993,
        "31.1,23,31.6": 1.000000000000
    }
    
    for test_q in [1.3, 2.7, 4.7, 10.5, 18.4, 31.1]:
        for test_r in [2, 3, 4, 5, 8, 13, 23]:
            for test_v in [3.6, 5.4, 7.9, 13.6, 17.3, 31.6]:
                p_range = tukey.prange(test_q, test_r, test_v, 1)
                p_target_r = target_r[str(test_q) + "," + str(test_r) + "," + str(test_v)]
                p_target_pascal = target_pascal[str(test_q) + "," + str(test_r) + "," + str(test_v)]
                # print("R", '{:.20f}'.format(abs(1 - p_range / p_target_r)), test_q, test_r, test_v)
                # print("Pascal", '{:.20f}'.format(abs(1 - p_range / p_target_pascal)), test_q, test_r, test_v)
                if test_q == 31.1 and test_r == 23 and test_v == 3.6:
                    pass  # larger difference ~0.0002
                else:
                    assert_equal(abs(1 - p_range/p_target_r) < 0.00009, True)
                assert_equal(abs(1 - p_range/p_target_pascal) < 0.00000004, True)

                # take a look at statsmodels.stats.libqsturng
                p_range_other = qsturng.psturng(test_q, test_r, test_v)
                if isinstance(p_range_other, np.ndarray):
                    p_range_other = p_range_other[0]
                # print("R", '{:.20f}'.format(abs(1 - p_range_other / p_target_r)), test_q, test_r, test_v)
                # print("Pascal", '{:.20f}'.format(abs(1 - p_range_other / p_target_pascal)), test_q, test_r, test_v)
                if test_q == 1.3:
                    pass  # larger difference 263399.731727232
                else:
                    assert_equal(abs(1 - p_range_other/p_target_r) < 15, True)
                    assert_equal(abs(1 - p_range_other/p_target_pascal) < 15, True)


def test_qrange():
    """ R code to generate target values used in this test
    for (p in c(0.02, 0.21, 0.53, 0.82, 0.89, 0.93, 0.97, 0.992, 0.9997)) {
        for (r in c(2, 3, 4, 5, 8, 13, 23)) {
            for (v in c(3.6, 5.4, 7.9, 13.6, 17.3, 31.6)) {
                print(paste(p, r, v, qtukey(p, r, v)))
            }
        }
    }
    """
    """ Pascal code to generate target values used in this test.
    This depends on the same pascal code in studentized_range.py
    
    var ifault:LongInt;
    p, v: Real;
    r: Integer;
    p_list: Array[1..9] of Real = (0.02, 0.21, 0.53, 0.82, 0.89, 0.93, 0.97, 0.992, 0.9997);
    r_list: Array[1..7] of Integer = (2, 3, 4, 5, 8, 13, 23);
    v_list: Array[1..6] of Real = (3.6, 5.4, 7.9, 13.6, 17.3, 31.6);
    
    begin
      for p in p_list do
      begin
          for r in r_list do
          begin
              for v in v_list do
              begin
                  writeln(p:4:4,',',r:2,',',v:4:1,':',qrange(p , r,  v, 1, ifault):18:12)
              end;
          end;
      end;
    end.
    """
    target_r = {
        "0.02,2,3.6": 0.0379728443961691,
        "0.02,2,5.4": 0.0371244181971232,
        "0.02,2,7.9": 0.0365903854610525,
        "0.02,2,13.6": 0.036110358270821,
        "0.02,2,17.3": 0.0359688795274797,
        "0.02,2,31.6": 0.0357345163052762,
        "0.02,3,3.6": 0.271493942623605,
        "0.02,3,5.4": 0.271237826964218,
        "0.02,3,7.9": 0.271075933701352,
        "0.02,3,13.6": 0.270929507712151,
        "0.02,3,17.3": 0.270886128757221,
        "0.02,3,31.6": 0.27081399893304,
        "0.02,4,3.6": 0.52508131076394,
        "0.02,4,5.4": 0.532374381411912,
        "0.02,4,7.9": 0.537507600295783,
        "0.02,4,13.6": 0.542557994531195,
        "0.02,4,17.3": 0.544136323438641,
        "0.02,4,31.6": 0.546850436800421,
        "0.02,5,3.6": 0.734951085052817,
        "0.02,5,5.4": 0.752774343598927,
        "0.02,5,7.9": 0.765728611449469,
        "0.02,5,13.6": 0.778856401034765,
        "0.02,5,17.3": 0.783045225296447,
        "0.02,5,31.6": 0.79035267101228,
        "0.02,8,3.6": 1.15896575446532,
        "0.02,8,5.4": 1.20729960854094,
        "0.02,8,7.9": 1.2446430774928,
        "0.02,8,13.6": 1.28488274334523,
        "0.02,8,17.3": 1.29832633665951,
        "0.02,8,31.6": 1.32259449456,
        "0.02,13,3.6": 1.5445433152291,
        "0.02,13,5.4": 1.62777820816383,
        "0.02,13,7.9": 1.69520225032997,
        "0.02,13,13.6": 1.77186291678339,
        "0.02,13,17.3": 1.79863066259256,
        "0.02,13,31.6": 1.84876400424113,
        "0.02,23,3.6": 1.93268854050803,
        "0.02,23,5.4": 2.05410009019375,
        "0.02,23,7.9": 2.15614684210677,
        "0.02,23,13.6": 2.27771758184998,
        "0.02,23,17.3": 2.32198896039058,
        "0.02,23,31.6": 2.408264862762,
        "0.21,2,3.6": 0.405601770465297,
        "0.21,2,5.4": 0.395765808496461,
        "0.21,2,7.9": 0.389617412586013,
        "0.21,2,13.6": 0.38411701403496,
        "0.21,2,17.3": 0.382500420953749,
        "0.21,2,31.6": 0.379826873329149,
        "0.21,3,3.6": 0.956460934633155,
        "0.21,3,5.4": 0.945831057286482,
        "0.21,3,7.9": 0.939201396570171,
        "0.21,3,13.6": 0.933264212151818,
        "0.21,3,17.3": 0.931515997886615,
        "0.21,3,31.6": 0.928619845005787,
        "0.21,4,3.6": 1.32464322298486,
        "0.21,4,5.4": 1.31902889094252,
        "0.21,4,7.9": 1.31614852027182,
        "0.21,4,13.6": 1.31403698889627,
        "0.21,4,17.3": 1.31350729801778,
        "0.21,4,31.6": 1.31272804248757,
        "0.21,5,3.6": 1.58981324161007,
        "0.21,5,5.4": 1.58980496896869,
        "0.21,5,7.9": 1.59133213718592,
        "0.21,5,13.6": 1.59393496352462,
        "0.21,5,17.3": 1.59495702164708,
        "0.21,5,31.6": 1.59693533450299,
        "0.21,8,3.6": 2.09441508709151,
        "0.21,8,5.4": 2.10818331891318,
        "0.21,8,7.9": 2.12121445161659,
        "0.21,8,13.6": 2.13689485452209,
        "0.21,8,17.3": 2.14242033166206,
        "0.21,8,31.6": 2.15267429634383,
        "0.21,13,3.6": 2.55207944362457,
        "0.21,13,5.4": 2.5803024368497,
        "0.21,13,7.9": 2.60618685919157,
        "0.21,13,13.6": 2.63753175353943,
        "0.21,13,17.3": 2.64875695451409,
        "0.21,13,31.6": 2.66996248989572,
        "0.21,23,3.6": 3.02684369576912,
        "0.21,23,5.4": 3.07061810828595,
        "0.21,23,7.9": 3.11100492627797,
        "0.21,23,13.6": None,
        "0.21,23,17.3": None,
        "0.21,23,31.6": None,
        "0.53,2,3.6": 1.14012466939151,
        "0.53,2,5.4": 1.09835692624492,
        "0.53,2,7.9": 1.0731134296436,
        "0.53,2,13.6": 1.05105607970645,
        "0.53,2,17.3": 1.04466339453426,
        "0.53,2,31.6": 1.03417784167835,
        "0.53,3,3.6": 1.84799424906232,
        "0.53,3,5.4": 1.78071189038229,
        "0.53,3,7.9": 1.74011089505485,
        "0.53,3,13.6": 1.70461959154869,
        "0.53,3,17.3": 1.69432342666277,
        "0.53,3,31.6": 1.67741932321294,
        "0.53,4,3.6": 2.28567726085715,
        "0.53,4,5.4": 2.2013017842654,
        "0.53,4,7.9": 2.15037666725685,
        "0.53,4,13.6": 2.10580381978487,
        "0.53,4,17.3": 2.09285418585852,
        "0.53,4,31.6": 2.07156621419931,
        "0.53,5,3.6": 2.59954890367142,
        "0.53,5,5.4": 2.50242712556494,
        "0.53,5,7.9": 2.4437237478708,
        "0.53,5,13.6": 2.39222270959891,
        "0.53,5,17.3": 2.3772260088857,
        "0.53,5,31.6": 2.35252454944572,
        "0.53,8,3.6": 3.20501330145465,
        "0.53,8,5.4": 3.08275516986035,
        "0.53,8,7.9": 3.0084956186602,
        "0.53,8,13.6": 2.9428472060176,
        "0.53,8,17.3": 2.92358022222645,
        "0.53,8,31.6": 2.89161358608045,
        "0.53,13,3.6": 3.76854940294204,
        "0.53,13,5.4": 3.62288835146884,
        "0.53,13,7.9": 3.53399446558382,
        "0.53,13,13.6": 3.45474059838309,
        "0.53,13,17.3": 3.43124803272634,
        "0.53,13,31.6": 3.39185110749485,
        "0.53,23,3.6": 4.36852794174905,
        "0.53,23,5.4": 4.19832339602344,
        "0.53,23,7.9": 4.09410239372728,
        "0.53,23,13.6": 4.00050786578596,
        "0.53,23,17.3": 3.97248325752331,
        "0.53,23,31.6": 3.92486394443505,
        "0.82,2,3.6": 2.3484241487948,
        "0.82,2,5.4": 2.17728068973506,
        "0.82,2,7.9": 2.08012610609391,
        "0.82,2,13.6": 1.99893128110391,
        "0.82,2,17.3": 1.97602393492717,
        "0.82,2,31.6": 1.93904349888804,
        "0.82,3,3.6": 3.23497856722995,
        "0.82,3,5.4": 2.95732557924731,
        "0.82,3,7.9": 2.7999412488388,
        "0.82,3,13.6": 2.66849629274173,
        "0.82,3,17.3": 2.63141897903099,
        "0.82,3,31.6": 2.57156395481103,
        "0.82,4,3.6": 3.79312707726918,
        "0.82,4,5.4": 3.44130809993679,
        "0.82,4,7.9": 3.24100147345548,
        "0.82,4,13.6": 3.07296169992092,
        "0.82,4,17.3": 3.02540143746087,
        "0.82,4,31.6": 2.94844142346916,
        "0.82,5,3.6": 4.20041220606514,
        "0.82,5,5.4": 3.79263529182225,
        "0.82,5,7.9": 3.55933851918073,
        "0.82,5,13.6": 3.36261508922654,
        "0.82,5,17.3": 3.30671054552182,
        "0.82,5,31.6": 3.21598112618654,
        "0.82,8,3.6": 5.00291860100562,
        "0.82,8,5.4": 4.48327257560172,
        "0.82,8,7.9": 4.18257292219394,
        "0.82,8,13.6": 3.92566491106708,
        "0.82,8,17.3": 3.85184300126181,
        "0.82,8,31.6": 3.73099488581216,
        "0.82,13,3.6": 5.76817307886484,
        "0.82,13,5.4": 5.14244295619498,
        "0.82,13,7.9": 4.7764379696646,
        "0.82,13,13.6": 4.45935134668645,
        "0.82,13,17.3": 4.36705100518412,
        "0.82,13,31.6": 4.21426299875684,
        "0.82,23,3.6": 6.59924870030826,
        "0.82,23,5.4": 5.86062561477597,
        "0.82,23,7.9": 5.42428510464398,
        "0.82,23,13.6": 5.04084113328591,
        "0.82,23,17.3": 4.92759020677458,
        "0.82,23,31.6": 4.73748624049776,
        "0.89,2,3.6": 2.98595043373786,
        "0.89,2,5.4": 2.70205377075145,
        "0.89,2,7.9": 2.54580706458979,
        "0.89,2,13.6": 2.41808012406126,
        "0.89,2,17.3": 2.38252565047863,
        "0.89,2,31.6": 2.32558187850258,
        "0.89,3,3.6": 3.97999606556224,
        "0.89,3,5.4": 3.53303922166519,
        "0.89,3,7.9": 3.28782503128551,
        "0.89,3,13.6": 3.08782455893381,
        "0.89,3,17.3": 3.03222870614616,
        "0.89,3,31.6": 2.94325948557006,
        "0.89,4,3.6": 4.61312259755615,
        "0.89,4,5.4": 4.05394231406303,
        "0.89,4,7.9": 3.74615024399617,
        "0.89,4,13.6": 3.49427549655615,
        "0.89,4,17.3": 3.4240842968583,
        "0.89,4,31.6": 3.31156457310433,
        "0.89,5,3.6": 5.07813060092853,
        "0.89,5,5.4": 4.43456474103672,
        "0.89,5,7.9": 4.07889962333526,
        "0.89,5,13.6": 3.78661577064983,
        "0.89,5,17.3": 3.70489415903125,
        "0.89,5,31.6": 3.57358200516125,
        "0.89,8,3.6": 6.00056196427633,
        "0.89,8,5.4": 5.18838409581541,
        "0.89,8,7.9": 4.73508205133226,
        "0.89,8,13.6": 4.35831337155112,
        "0.89,8,17.3": 4.25196719538997,
        "0.89,8,31.6": 4.07985445532258,
        "0.89,13,3.6": 6.88637328855513,
        "0.89,13,5.4": 5.91391779479408,
        "0.89,13,7.9": 5.36585282374876,
        "0.89,13,13.6": 4.90457489871637,
        "0.89,13,17.3": 4.77286937812539,
        "0.89,13,31.6": 4.5576617534111,
        "0.89,23,3.6": 7.85362353377893,
        "0.89,23,5.4": 6.70995080927142,
        "0.89,23,7.9": 6.05939941128688,
        "0.89,23,13.6": 5.50453737006103,
        "0.89,23,17.3": 5.3439695918152,
        "0.89,23,31.6": 5.07831135510983,
        "0.93,2,3.6": 3.6088960908884,
        "0.93,2,5.4": 3.1872150843384,
        "0.93,2,7.9": 2.96163854583518,
        "0.93,2,13.6": 2.78093549019424,
        "0.93,2,17.3": 2.73125210401893,
        "0.93,2,31.6": 2.65225615740708,
        "0.93,3,3.6": 4.71732877116092,
        "0.93,3,5.4": 4.07059153568188,
        "0.93,3,7.9": 3.72632671440088,
        "0.93,3,13.6": 3.45161939802284,
        "0.93,3,17.3": 3.3762832072016,
        "0.93,3,31.6": 3.25669155862881,
        "0.93,4,3.6": 5.42950456914788,
        "0.93,4,5.4": 4.62918703313337,
        "0.93,4,7.9": 4.20228161361165,
        "0.93,4,13.6": 3.86089432419764,
        "0.93,4,17.3": 3.7671204639117,
        "0.93,4,31.6": 3.61809888148683,
        "0.93,5,3.6": 5.95496821478736,
        "0.93,5,5.4": 5.03943125955628,
        "0.93,5,7.9": 4.549522798441,
        "0.93,5,13.6": 4.15644053177453,
        "0.93,5,17.3": 4.04818713201143,
        "0.93,5,31.6": 3.87584572361477,
        "0.93,8,3.6": 7.00212006625,
        "0.93,8,5.4": 5.85642008278398,
        "0.93,8,7.9": 5.23819183461338,
        "0.93,8,13.6": 4.73733254749421,
        "0.93,8,17.3": 4.59828835853516,
        "0.93,8,31.6": 4.37561162701899,
        "0.93,13,3.6": 8.01242462054647,
        "0.93,13,5.4": 6.64753273620455,
        "0.93,13,7.9": 5.90462326363308,
        "0.93,13,13.6": 5.29596237931276,
        "0.93,13,17.3": 5.12525420021095,
        "0.93,13,31.6": 4.8495902366275,
        "0.93,23,3.6": 9.11958636001058,
        "0.93,23,5.4": 7.51983454483342,
        "0.93,23,7.9": 6.64169003387054,
        "0.93,23,13.6": 5.91332854098895,
        "0.93,23,17.3": 5.70650238663286,
        "0.93,23,31.6": 5.36875086624655,
        "0.97,2,3.6": 4.92299721990622,
        "0.97,2,5.4": 4.13442775513433,
        "0.97,2,7.9": 3.73466079186824,
        "0.97,2,13.6": 3.42645358547836,
        "0.97,2,17.3": 3.34367662329808,
        "0.97,2,31.6": 3.21385763251038,
        "0.97,3,3.6": 6.29439015466168,
        "0.97,3,5.4": 5.13343083171728,
        "0.97,3,7.9": 4.54973793709429,
        "0.97,3,13.6": 4.1028202550653,
        "0.97,3,17.3": 3.98335564730737,
        "0.97,3,31.6": 3.79656907544292,
        "0.97,4,3.6": 7.18601768024059,
        "0.97,4,5.4": 5.7736835501501,
        "0.97,4,7.9": 5.06366759879103,
        "0.97,4,13.6": 4.5199759385241,
        "0.97,4,17.3": 4.37463869793075,
        "0.97,4,31.6": 4.14741327519585,
        "0.97,5,3.6": 7.84783062117195,
        "0.97,5,5.4": 6.24739377544841,
        "0.97,5,7.9": 5.44150776480307,
        "0.97,5,13.6": 4.82327850534656,
        "0.97,5,17.3": 4.65779172181239,
        "0.97,5,31.6": 4.39884378754045,
        "0.97,8,3.6": 9.1744223034103,
        "0.97,8,5.4": 7.19819864539376,
        "0.97,8,7.9": 6.19737269413167,
        "0.97,8,13.6": 5.42433368632203,
        "0.97,8,17.3": 5.21625263164341,
        "0.97,8,31.6": 4.88939695339555,
        "0.97,13,3.6": 10.4619814413281,
        "0.97,13,5.4": 8.12667684857382,
        "0.97,13,7.9": 6.93610583274537,
        "0.97,13,13.6": 6.00823414574394,
        "0.97,13,17.3": 5.75644148930593,
        "0.97,13,31.6": 5.35844535898354,
        "0.97,23,3.6": 11.8797039803029,
        "0.97,23,5.4": 9.15746011361163,
        "0.97,23,7.9": 7.76016556486031,
        "0.97,23,13.6": 6.65973010225976,
        "0.97,23,17.3": 6.35792903502472,
        "0.97,23,31.6": 5.87649066782794,
        "0.992,2,3.6": 7.53411578777655,
        "0.992,2,5.4": 5.79020301211938,
        "0.992,2,7.9": 4.97863906081244,
        "0.992,2,13.6": 4.38987559355712,
        "0.992,2,17.3": 4.23755934674944,
        "0.992,2,31.6": 4.00383173852055,
        "0.992,3,3.6": 9.4749808571327,
        "0.992,3,5.4": 7.02173911790092,
        "0.992,3,7.9": 5.8946426023581,
        "0.992,3,13.6": 5.08597110492787,
        "0.992,3,17.3": 4.87825406979388,
        "0.992,3,31.6": 4.5612653716126,
        "0.992,4,3.6": 10.7497522135984,
        "0.992,4,5.4": 7.82233159676187,
        "0.992,4,7.9": 6.48121940986608,
        "0.992,4,13.6": 5.52137305943156,
        "0.992,4,17.3": 5.27547586817554,
        "0.992,4,31.6": 4.90063294494985,
        "0.992,5,3.6": 11.7011478319005,
        "0.992,5,5.4": 8.41916369543262,
        "0.992,5,7.9": 6.91627304247619,
        "0.992,5,13.6": 5.84077390402259,
        "0.992,5,17.3": 5.56530701699064,
        "0.992,5,31.6": 5.14553417193973,
        "0.992,8,3.6": 13.6198582854874,
        "0.992,8,5.4": 9.62650773611909,
        "0.992,8,7.9": 7.79501946370031,
        "0.992,8,13.6": 6.48014272774173,
        "0.992,8,17.3": 6.14252149949578,
        "0.992,8,31.6": 5.62735420469301,
        "0.992,13,3.6": 15.4876318652478,
        "0.992,13,5.4": 10.8154200857505,
        "0.992,13,7.9": 8.66318359093293,
        "0.992,13,13.6": 7.10882274031012,
        "0.992,13,17.3": 6.70753021177038,
        "0.992,13,31.6": 6.09290226848611,
        "0.992,23,3.6": 17.5157057907425,
        "0.992,23,5.4": 12.1434954773386,
        "0.992,23,7.9": 9.64063078100353,
        "0.992,23,13.6": 7.81822062054193,
        "0.992,23,17.3": 7.34384429652271,
        "0.992,23,31.6": 6.61242415284825,
        "0.9997,2,3.6": 19.6891078601621,
        "0.9997,2,5.4": 11.6121034765339,
        "0.9997,2,7.9": 8.64587402685517,
        "0.9997,2,13.6": 6.80362314230411,
        "0.9997,2,17.3": 6.3710955144379,
        "0.9997,2,31.6": 5.74334782050552,
        "0.9997,3,3.6": 24.8423373784882,
        "0.9997,3,5.4": 13.7873129763205,
        "0.9997,3,7.9": 9.94206145378525,
        "0.9997,3,13.6": 7.59636187819074,
        "0.9997,3,17.3": 7.05284270666305,
        "0.9997,3,31.6": 6.27080837132358,
        "0.9997,4,3.6": 28.6418000446993,
        "0.9997,4,5.4": 15.2259790566758,
        "0.9997,4,7.9": 10.7896330145612,
        "0.9997,4,13.6": 8.10412201370809,
        "0.9997,4,17.3": 7.48536830197069,
        "0.9997,4,31.6": 6.59871978955314,
        "0.9997,5,3.6": 31.8043300960994,
        "0.9997,5,5.4": 16.3111944712121,
        "0.9997,5,7.9": 11.4256180549636,
        "0.9997,5,13.6": 8.48167530504539,
        "0.9997,5,17.3": 7.8053198813507,
        "0.9997,5,31.6": 6.838358800342,
        "0.9997,8,3.6": 38.7222884357103,
        "0.9997,8,5.4": 18.5509468394516,
        "0.9997,8,7.9": 12.7267087856454,
        "0.9997,8,13.6": 9.24943095663016,
        "0.9997,8,17.3": 8.45272974841405,
        "0.9997,8,31.6": 7.31683666152145,
        "0.9997,13,3.6": 45.4550697745019,
        "0.9997,13,5.4": 20.8457921107823,
        "0.9997,13,7.9": 14.0317678042403,
        "0.9997,13,13.6": 10.0185319467161,
        "0.9997,13,17.3": 9.09869872438005,
        "0.9997,13,31.6": 7.78758027573278,
        "0.9997,23,3.6": 52.6363925999317,
        "0.9997,23,5.4": 23.552440816697,
        "0.9997,23,7.9": 15.5263157635813,
        "0.9997,23,13.6": 10.9014060013169,
        "0.9997,23,17.3": 9.83951573004712,
        "0.9997,23,31.6": 8.32218241296747
    }

    target_pascal = {
        "0.0200,2,3.6": 0.037972833310,
        "0.0200,2,5.4": 0.037124419342,
        "0.0200,2,7.9": 0.036590385808,
        "0.0200,2,13.6": 0.036110358388,
        "0.0200,2,17.3": 0.035968879601,
        "0.0200,2,31.6": 0.035734515339,
        "0.0200,3,3.6": 0.271493860349,
        "0.0200,3,5.4": 0.271237731266,
        "0.0200,3,7.9": 0.271075900256,
        "0.0200,3,13.6": 0.270929470312,
        "0.0200,3,17.3": 0.270886090103,
        "0.0200,3,31.6": 0.270813958107,
        "0.0200,4,3.6": 0.525081380063,
        "0.0200,4,5.4": 0.532374422346,
        "0.0200,4,7.9": 0.537507651577,
        "0.0200,4,13.6": 0.542558054027,
        "0.0200,4,17.3": 0.544136385647,
        "0.0200,4,31.6": 0.546850516250,
        "0.0200,5,3.6": 0.734951019256,
        "0.0200,5,5.4": 0.752774303344,
        "0.0200,5,7.9": 0.765728506753,
        "0.0200,5,13.6": 0.778856336985,
        "0.0200,5,17.3": 0.783045171671,
        "0.0200,5,31.6": 0.790352632965,
        "0.0200,8,3.6": 1.158965720291,
        "0.0200,8,5.4": 1.207299556634,
        "0.0200,8,7.9": 1.247694039364,
        "0.0200,8,13.6": 1.284883628017,
        "0.0200,8,17.3": 1.298326558597,
        "0.0200,8,31.6": 1.322594646206,
        "0.0200,13,3.6": 1.544543213655,
        "0.0200,13,5.4": 1.627778171740,
        "0.0200,13,7.9": 1.697641568947,
        "0.0200,13,13.6": 1.771863076324,
        "0.0200,13,17.3": 1.798630546211,
        "0.0200,13,31.6": 1.848763801421,
        "0.0200,23,3.6": 1.932688361244,
        "0.0200,23,5.4": 2.054088729437,
        "0.0200,23,7.9": 2.156146676272,
        "0.0200,23,13.6": 2.277717875152,
        "0.0200,23,17.3": 2.321988900704,
        "0.0200,23,31.6": 2.408264851868,
        "0.2100,2,3.6": 0.405601629347,
        "0.2100,2,5.4": 0.395765814072,
        "0.2100,2,7.9": 0.389617413153,
        "0.2100,2,13.6": 0.384117046288,
        "0.2100,2,17.3": 0.382500451133,
        "0.2100,2,31.6": 0.379826899946,
        "0.2100,3,3.6": 0.956460921683,
        "0.2100,3,5.4": 0.945831058360,
        "0.2100,3,7.9": 0.939201397681,
        "0.2100,3,13.6": 0.933264215685,
        "0.2100,3,17.3": 0.931516002710,
        "0.2100,3,31.6": 0.928619852906,
        "0.2100,4,3.6": 1.324643236010,
        "0.2100,4,5.4": 1.319028956065,
        "0.2100,4,7.9": 1.316148520280,
        "0.2100,4,13.6": 1.314036988920,
        "0.2100,4,17.3": 1.313507298056,
        "0.2100,4,31.6": 1.312728042570,
        "0.2100,5,3.6": 1.589813252389,
        "0.2100,5,5.4": 1.589805037231,
        "0.2100,5,7.9": 1.591332137185,
        "0.2100,5,13.6": 1.593934963559,
        "0.2100,5,17.3": 1.594957021709,
        "0.2100,5,31.6": 1.596935334655,
        "0.2100,8,3.6": 2.094415076698,
        "0.2100,8,5.4": 2.108183282859,
        "0.2100,8,7.9": 2.121214352814,
        "0.2100,8,13.6": 2.136894854635,
        "0.2100,8,17.3": 2.142420331766,
        "0.2100,8,31.6": 2.152674296509,
        "0.2100,13,3.6": 2.552079443554,
        "0.2100,13,5.4": 2.580302450581,
        "0.2100,13,7.9": 2.606186968115,
        "0.2100,13,13.6": 2.637531751915,
        "0.2100,13,17.3": 2.648756942750,
        "0.2100,13,31.6": 2.669961760507,
        "0.2100,23,3.6": 3.026843703704,
        "0.2100,23,5.4": 3.070618111745,
        "0.2100,23,7.9": 3.111004941601,
        "0.2100,23,13.6": 3.161108839003,
        "0.2100,23,17.3": 3.179524561248,
        "0.2100,23,31.6": 3.215216003419,
        "0.5300,2,3.6": 1.140124087939,
        "0.5300,2,5.4": 1.098356958747,
        "0.5300,2,7.9": 1.073113436682,
        "0.5300,2,13.6": 1.051056066401,
        "0.5300,2,17.3": 1.044663386635,
        "0.5300,2,31.6": 1.034177856127,
        "0.5300,3,3.6": 1.847994192538,
        "0.5300,3,5.4": 1.780711733346,
        "0.5300,3,7.9": 1.740110773126,
        "0.5300,3,13.6": 1.704619507548,
        "0.5300,3,17.3": 1.694323353451,
        "0.5300,3,31.6": 1.677419266797,
        "0.5300,4,3.6": 2.285677271844,
        "0.5300,4,5.4": 2.201301779957,
        "0.5300,4,7.9": 2.150376663457,
        "0.5300,4,13.6": 2.105803817062,
        "0.5300,4,17.3": 2.092854183578,
        "0.5300,4,31.6": 2.071566212660,
        "0.5300,5,3.6": 2.599548905698,
        "0.5300,5,5.4": 2.502427125396,
        "0.5300,5,7.9": 2.443723747836,
        "0.5300,5,13.6": 2.392222709570,
        "0.5300,5,17.3": 2.377226008864,
        "0.5300,5,31.6": 2.352524549437,
        "0.5300,8,3.6": 3.205013309760,
        "0.5300,8,5.4": 3.082755170239,
        "0.5300,8,7.9": 3.008495642375,
        "0.5300,8,13.6": 2.942847206415,
        "0.5300,8,17.3": 2.923580222720,
        "0.5300,8,31.6": 2.891613689489,
        "0.5300,13,3.6": 3.768549400345,
        "0.5300,13,5.4": 3.622888337847,
        "0.5300,13,7.9": 3.533994410638,
        "0.5300,13,13.6": 3.454740525289,
        "0.5300,13,17.3": 3.431247959712,
        "0.5300,13,31.6": 3.391851043443,
        "0.5300,23,3.6": 4.368527913188,
        "0.5300,23,5.4": 4.198323401008,
        "0.5300,23,7.9": 4.094102417379,
        "0.5300,23,13.6": 4.000507832390,
        "0.5300,23,17.3": 3.972483223389,
        "0.5300,23,31.6": 3.924863894875,
        "0.8200,2,3.6": 2.348421186181,
        "0.8200,2,5.4": 2.177280824668,
        "0.8200,2,7.9": 2.080126187798,
        "0.8200,2,13.6": 1.998931354580,
        "0.8200,2,17.3": 1.976024003659,
        "0.8200,2,31.6": 1.939043522970,
        "0.8200,3,3.6": 3.234978099553,
        "0.8200,3,5.4": 2.957325608790,
        "0.8200,3,7.9": 2.799941277864,
        "0.8200,3,13.6": 2.668496285862,
        "0.8200,3,17.3": 2.631418971302,
        "0.8200,3,31.6": 2.571563946243,
        "0.8200,4,3.6": 3.793127238805,
        "0.8200,4,5.4": 3.441308088776,
        "0.8200,4,7.9": 3.241001447811,
        "0.8200,4,13.6": 3.072961718162,
        "0.8200,4,17.3": 3.025401466829,
        "0.8200,4,31.6": 2.948441418626,
        "0.8200,5,3.6": 4.200412241130,
        "0.8200,5,5.4": 3.792635289864,
        "0.8200,5,7.9": 3.559338506232,
        "0.8200,5,13.6": 3.362615089249,
        "0.8200,5,17.3": 3.306710554007,
        "0.8200,5,31.6": 3.215981153250,
        "0.8200,8,3.6": 5.002918621155,
        "0.8200,8,5.4": 4.483272576514,
        "0.8200,8,7.9": 4.182572937082,
        "0.8200,8,13.6": 3.925664910571,
        "0.8200,8,17.3": 3.851842980880,
        "0.8200,8,31.6": 3.730994885923,
        "0.8200,13,3.6": 5.768173065766,
        "0.8200,13,5.4": 5.142442965149,
        "0.8200,13,7.9": 4.776437971658,
        "0.8200,13,13.6": 4.459351363524,
        "0.8200,13,17.3": 4.367051007499,
        "0.8200,13,31.6": 4.214262995023,
        "0.8200,23,3.6": 6.599248670306,
        "0.8200,23,5.4": 5.860625818202,
        "0.8200,23,7.9": 5.424285100989,
        "0.8200,23,13.6": 5.040841137538,
        "0.8200,23,17.3": 4.927590190666,
        "0.8200,23,31.6": 4.737486236017,
        "0.8900,2,3.6": 2.985943668653,
        "0.8900,2,5.4": 2.702053990677,
        "0.8900,2,7.9": 2.545807033453,
        "0.8900,2,13.6": 2.418080158265,
        "0.8900,2,17.3": 2.382525729969,
        "0.8900,2,31.6": 2.325581941305,
        "0.8900,3,3.6": 3.979994858599,
        "0.8900,3,5.4": 3.533039193646,
        "0.8900,3,7.9": 3.287824999330,
        "0.8900,3,13.6": 3.087824609907,
        "0.8900,3,17.3": 3.032228793520,
        "0.8900,3,31.6": 2.943259697818,
        "0.8900,4,3.6": 4.613123151555,
        "0.8900,4,5.4": 4.053942228981,
        "0.8900,4,7.9": 3.746150315457,
        "0.8900,4,13.6": 3.494275411525,
        "0.8900,4,17.3": 3.424084351552,
        "0.8900,4,31.6": 3.311564616212,
        "0.8900,5,3.6": 5.078130757401,
        "0.8900,5,5.4": 4.434564729746,
        "0.8900,5,7.9": 4.078899648486,
        "0.8900,5,13.6": 3.786615712801,
        "0.8900,5,17.3": 3.704894193555,
        "0.8900,5,31.6": 3.573582015734,
        "0.8900,8,3.6": 6.000561993020,
        "0.8900,8,5.4": 5.188384097305,
        "0.8900,8,7.9": 4.735082049420,
        "0.8900,8,13.6": 4.358313280986,
        "0.8900,8,17.3": 4.251967146025,
        "0.8900,8,31.6": 4.079854437771,
        "0.8900,13,3.6": 6.886373337948,
        "0.8900,13,5.4": 5.913917836947,
        "0.8900,13,7.9": 5.365852825511,
        "0.8900,13,13.6": 4.904574922564,
        "0.8900,13,17.3": 4.772869347125,
        "0.8900,13,31.6": 4.557661732013,
        "0.8900,23,3.6": 7.853623014722,
        "0.8900,23,5.4": 6.709950706606,
        "0.8900,23,7.9": 6.059399440508,
        "0.8900,23,13.6": 5.504537443217,
        "0.8900,23,17.3": 5.343969918380,
        "0.8900,23,31.6": 5.078311328865,
        "0.9300,2,3.6": 3.608882687247,
        "0.9300,2,5.4": 3.187215382673,
        "0.9300,2,7.9": 2.961638463099,
        "0.9300,2,13.6": 2.780935395138,
        "0.9300,2,17.3": 2.731252080539,
        "0.9300,2,31.6": 2.652256064538,
        "0.9300,3,3.6": 4.717326000722,
        "0.9300,3,5.4": 4.070591423964,
        "0.9300,3,7.9": 3.726326870319,
        "0.9300,3,13.6": 3.451619520587,
        "0.9300,3,17.3": 3.376283279743,
        "0.9300,3,31.6": 3.256691558593,
        "0.9300,4,3.6": 5.429506102546,
        "0.9300,4,5.4": 4.629186904192,
        "0.9300,4,7.9": 4.202281702355,
        "0.9300,4,13.6": 3.860894207153,
        "0.9300,4,17.3": 3.767120392201,
        "0.9300,4,31.6": 3.618098881437,
        "0.9300,5,3.6": 5.954968816671,
        "0.9300,5,5.4": 5.039431161463,
        "0.9300,5,7.9": 4.549522909602,
        "0.9300,5,13.6": 4.156440590369,
        "0.9300,5,17.3": 4.048187233229,
        "0.9300,5,31.6": 3.875845723531,
        "0.9300,8,3.6": 7.002120101865,
        "0.9300,8,5.4": 5.856420246695,
        "0.9300,8,7.9": 5.238191956701,
        "0.9300,8,13.6": 4.737332596795,
        "0.9300,8,17.3": 4.598288486745,
        "0.9300,8,31.6": 4.375611783595,
        "0.9300,13,3.6": 8.012425087630,
        "0.9300,13,5.4": 6.647532933762,
        "0.9300,13,7.9": 5.904623195913,
        "0.9300,13,13.6": 5.295962277526,
        "0.9300,13,17.3": 5.125254304395,
        "0.9300,13,31.6": 4.849590327546,
        "0.9300,23,3.6": 9.119567841954,
        "0.9300,23,5.4": 7.519835275875,
        "0.9300,23,7.9": 6.641689975029,
        "0.9300,23,13.6": 5.913328490091,
        "0.9300,23,17.3": 5.706502428414,
        "0.9300,23,31.6": 5.368750920965,
        "0.9700,2,3.6": 4.922946350684,
        "0.9700,2,5.4": 4.134428552950,
        "0.9700,2,7.9": 3.734660990507,
        "0.9700,2,13.6": 3.426453790539,
        "0.9700,2,17.3": 3.343676953855,
        "0.9700,2,31.6": 3.213857952240,
        "0.9700,3,3.6": 6.294375335206,
        "0.9700,3,5.4": 5.133431132932,
        "0.9700,3,7.9": 4.549737496376,
        "0.9700,3,13.6": 4.102820259922,
        "0.9700,3,17.3": 3.983355691714,
        "0.9700,3,31.6": 3.796569075319,
        "0.9700,4,3.6": 7.186027531011,
        "0.9700,4,5.4": 5.773683613027,
        "0.9700,4,7.9": 5.063667606025,
        "0.9700,4,13.6": 4.519975940393,
        "0.9700,4,17.3": 4.374638730456,
        "0.9700,4,31.6": 4.147413274968,
        "0.9700,5,3.6": 7.847835338847,
        "0.9700,5,5.4": 6.247393716094,
        "0.9700,5,7.9": 5.441507847815,
        "0.9700,5,13.6": 4.823278505934,
        "0.9700,5,17.3": 4.657791743016,
        "0.9700,5,31.6": 4.398843787224,
        "0.9700,8,3.6": 9.174428279799,
        "0.9700,8,5.4": 7.198198595178,
        "0.9700,8,7.9": 6.197372842465,
        "0.9700,8,13.6": 5.424333686338,
        "0.9700,8,17.3": 5.216252637763,
        "0.9700,8,31.6": 4.889396952876,
        "0.9700,13,3.6": 10.461883835605,
        "0.9700,13,5.4": 8.126677906283,
        "0.9700,13,7.9": 6.936105714417,
        "0.9700,13,13.6": 6.008234139705,
        "0.9700,13,17.3": 5.756441491514,
        "0.9700,13,31.6": 5.358445358516,
        "0.9700,23,3.6": 11.879004680649,
        "0.9700,23,5.4": 9.157432557410,
        "0.9700,23,7.9": 7.760166360789,
        "0.9700,23,13.6": 6.659730303836,
        "0.9700,23,17.3": 6.357929029055,
        "0.9700,23,31.6": 5.876490667966,
        "0.9920,2,3.6": 7.533708170036,
        "0.9920,2,5.4": 5.790208095488,
        "0.9920,2,7.9": 4.978638952537,
        "0.9920,2,13.6": 4.389874802553,
        "0.9920,2,17.3": 4.237560258291,
        "0.9920,2,31.6": 4.003830309887,
        "0.9920,3,3.6": 9.474792495727,
        "0.9920,3,5.4": 7.021742963943,
        "0.9920,3,7.9": 5.894643920419,
        "0.9920,3,13.6": 5.085873506145,
        "0.9920,3,17.3": 4.878255052108,
        "0.9920,3,31.6": 4.561266599569,
        "0.9920,4,3.6": 10.749968513841,
        "0.9920,4,5.4": 7.822329732667,
        "0.9920,4,7.9": 6.481220513209,
        "0.9920,4,13.6": 5.521372471464,
        "0.9920,4,17.3": 5.275476739230,
        "0.9920,4,31.6": 4.900632142742,
        "0.9920,5,3.6": 11.701347476383,
        "0.9920,5,5.4": 8.419161285124,
        "0.9920,5,7.9": 6.916273814159,
        "0.9920,5,13.6": 5.840773438470,
        "0.9920,5,17.3": 5.565307684010,
        "0.9920,5,31.6": 5.145533287636,
        "0.9920,8,3.6": 13.617697668836,
        "0.9920,8,5.4": 9.626509569694,
        "0.9920,8,7.9": 7.795019811219,
        "0.9920,8,13.6": 6.480143273666,
        "0.9920,8,17.3": 6.142520706249,
        "0.9920,8,31.6": 5.627355654700,
        "0.9920,13,3.6": 15.485365410760,
        "0.9920,13,5.4": 10.815297252467,
        "0.9920,13,7.9": 8.663182559731,
        "0.9920,13,13.6": 7.108822322493,
        "0.9920,13,17.3": 6.707530831900,
        "0.9920,13,31.6": 6.092903014544,
        "0.9920,23,3.6": 17.553865580510,
        "0.9920,23,5.4": 12.143830249122,
        "0.9920,23,7.9": 9.640601058179,
        "0.9920,23,13.6": 7.818220578914,
        "0.9920,23,17.3": 7.343844292775,
        "0.9920,23,31.6": 6.612423353407,
        "0.9997,2,3.6": 19.593657331568,
        "0.9997,2,5.4": 11.612620385885,
        "0.9997,2,7.9": 8.645866525994,
        "0.9997,2,13.6": 6.803623149323,
        "0.9997,2,17.3": 6.371095691639,
        "0.9997,2,31.6": 5.743371830021,
        "0.9997,3,3.6": 24.388836109945,
        "0.9997,3,5.4": 13.788454769354,
        "0.9997,3,7.9": 9.942059972911,
        "0.9997,3,13.6": 7.596361898821,
        "0.9997,3,17.3": 7.052842708335,
        "0.9997,3,31.6": 6.270808371485,
        "0.9997,4,3.6": 27.525561975474,
        "0.9997,4,5.4": 15.225499761853,
        "0.9997,4,7.9": 10.789650407913,
        "0.9997,4,13.6": 8.104122068946,
        "0.9997,4,17.3": 7.485368307575,
        "0.9997,4,31.6": 6.598719795975,
        "0.9997,5,3.6": 29.843172117115,
        "0.9997,5,5.4": 16.305758576641,
        "0.9997,5,7.9": 11.425652799616,
        "0.9997,5,13.6": 8.481675216259,
        "0.9997,5,17.3": 7.805319898976,
        "0.9997,5,31.6": 6.838358842819,
        "0.9997,8,3.6": 34.449114078245,
        "0.9997,8,5.4": 18.507828392086,
        "0.9997,8,7.9": 12.726588586296,
        "0.9997,8,13.6": 9.249430320284,
        "0.9997,8,17.3": 8.452729711289,
        "0.9997,8,31.6": 7.316836664380,
        "0.9997,13,3.6": 38.843228857488,
        "0.9997,13,5.4": 20.682349284851,
        "0.9997,13,7.9": 14.029803924045,
        "0.9997,13,13.6": 10.018530505869,
        "0.9997,13,17.3": 9.098698141041,
        "0.9997,13,31.6": 7.787580303501,
        "0.9997,23,3.6": 43.368181707201,
        "0.9997,23,5.4": 23.081844303286,
        "0.9997,23,7.9": 15.513209171172,
        "0.9997,23,13.6": 10.901425365377,
        "0.9997,23,17.3": 9.839508734907,
        "0.9997,23,31.6": 8.322182847023
    }

    for test_p in [0.02, 0.21, 0.53, 0.82, 0.89, 0.93, 0.97, 0.992]:
        for test_r in [2, 3, 4, 5, 8, 13, 23]:
            for test_v in [3.6, 5.4, 7.9, 13.6, 17.3, 31.6]:
                q_range = tukey.qrange(test_p, test_r, test_v, 1)
                q_target_r = target_r[str(test_p) + "," + str(test_r) + "," + str(test_v)]
                q_target_pascal = target_pascal["{:.4f}".format(test_p) + "," + str(test_r) + "," + str(test_v)]
                if q_target_r is not None:
                    # print("R", '{:.20f}'.format(abs(1 - q_range / q_target_r)), test_p, test_r, test_v)
                    if test_p == 0.992 and test_v == 3.6:
                        pass  # this is further off ~0.002
                    elif test_p == 0.02 and test_v == 7.9:
                        pass  # this is further off ~0.002
                    else:
                        assert_equal(abs(1 - q_range/q_target_r) < 0.00006, True)
                if q_target_pascal is not None:
                    # print("Pascal", '{:.20f}'.format(abs(1 - q_range / q_target_pascal)), test_p, test_r, test_v)
                    assert_equal(abs(1 - q_range / q_target_pascal) <  0.00000000002, True)

                # take a look at statsmodels.stats.libqsturng
                if test_p < 0.1:
                    continue  # not supported
                elif test_p == 0.21:
                    continue  # larger difference 0.05
                q_range_other = qsturng.qsturng(test_p, test_r, test_v)

                if q_target_r is not None:
                    # print("R", '{:.20f}'.format(abs(1 - q_range_other / q_target_r)), test_p, test_r, test_v)
                    assert_equal(abs(1 - q_range_other/q_target_r) < 0.0025, True)
                if q_target_pascal is not None:
                    # print("Pascal", '{:.20f}'.format(abs(1 - q_range_other / q_target_pascal)), test_p, test_r, test_v)
                    assert_equal(abs(1 - q_range_other / q_target_pascal) < 0.0025, True)


if __name__ == "__main__":
    test_prange()
    test_qrange()

